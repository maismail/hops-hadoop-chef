#!/bin/bash

source <%=node['hops']['conf_dir']%>/hadoop-env.sh 

export PATH=<%=node['hops']['bin_dir']%>:$PATH

TEST_DIR=$1
DST_DIR=$2

LOGDIR=logs/dfsops

if [ ! -d "$LOGDIR" ]
then
    mkdir -p ./$LOGDIR
fi

DATE=`date +%Y-%m-%d:%H:%M:%S`
RESULTS=${LOGDIR}/${DATE}_op

echo Running LS 
echo ===============================================================

{ time hdfs dfs -ls ${TEST_DIR} ; } > ${RESULTS}_ls 2>&1

TEST_DIR_NEW=${TEST_DIR}_new

echo Running Rename 
echo ===============================================================

{ time hdfs dfs -mv ${TEST_DIR} ${TEST_DIR_NEW} ; } > ${RESULTS}_rename 2>&1

echo Running Move 
echo ===============================================================

DIR_NAME=`basename ${TEST_DIR_NEW}`
{ time hdfs dfs -mv ${TEST_DIR_NEW} ${DST_DIR} ; } > ${RESULTS}_mv 2>&1

echo Running DELETE 
echo ===============================================================

{ time hdfs dfs -rm -r ${DST_DIR}/${DIR_NAME} ; } > ${RESULTS}_delete 2>&1
