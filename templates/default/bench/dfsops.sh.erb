#!/bin/bash

source <%=node['hops']['conf_dir']%>/hadoop-env.sh 

export PATH=<%=node['hops']['bin_dir']%>:$PATH

TEST_DIR=$1

DATE=`date +%Y-%m-%d-%H-%M-%S`
LOGDIR=logs/dfsops/$DATE

if [ ! -d "$LOGDIR" ]
then
    mkdir -p ./$LOGDIR
fi

RESULTS=${LOGDIR}/op

TIMES=3
counter=0

while [  $counter -lt $TIMES ]; do
    echo Running LS 
    echo ===============================================================

    { time hdfs dfs -ls ${TEST_DIR} ; } > ${RESULTS}_ls_${counter} 2>&1

    echo Running mv 
    echo ===============================================================

    OLD_TEST_DIR=${TEST_DIR}
    TEST_DIR=${TEST_DIR}_new_${counter}

    { time hdfs dfs -mv ${OLD_TEST_DIR} ${TEST_DIR} ; } > ${RESULTS}_mv_${counter} 2>&1

    let counter+=1
done

echo Running DELETE 
echo ===============================================================

{ time hdfs dfs -rm -r -skipTrash ${TEST_DIR} ; } > ${RESULTS}_delete 2>&1
